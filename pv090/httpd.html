<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2" />
<link rel="stylesheet" href="http://www.fi.muni.cz/~kas/css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="http://www.fi.muni.cz/~kas/css/pv090ref.css" type="text/css" media="screen" />
<title>HTTP servery</title>
</head>
<body>

<div id="nadpis">
<h1>HTTP servery</h1>
<h2>Martin Bukatoviè, xbukatov@fi.muni.cz</h2>
</div>

<h2>Obsah</h2>
<ul>
<li><a href="#http">Protokol HTTP</a></li>
<ul>
	<li><a href="#http:verze">Verze protokolu</a></li>
	<li><a href="#http:metody">Metody</a></li>
	<li><a href="#http:header">Hlavièky</a></li>
	<li><a href="#http:kody">Stavové kódy</a></li>
</ul>
<li><a href="#apache">Apache</a></li>
<ul>
	<li><a href="#apache:conf">Konfigurace</a></li>
	<li><a href="#apache:mod">Moduly</a></li>
	<li><a href="#apache:virt">Virtuální servery</a></li>
	<li><a href="#apache:ssl">SSL</a></li>
	<li><a href="#apache:cgi">CGI</a></li>
</ul>
<li><a href="#impl">Alternativní implementace</a></li>
<li><a href="#literatura">Literatura</a></li>
</ul>

<h2 id="http">Protokol HTTP</h2>
<p><em>HyperText Transfer Protocol</em> je sí»ový aplikaèní protokol, který byl pùvodnì navr¾en pro pøenos HTML stránek a pozdìji byl roz¹íøen o mo¾nost pøenosu libovolných dat. <!-- jak email -->
Vývoj protokolu probíhal pod vedením organizací W3C (World Wide Web Consortium) a IETF (Internet Engineering Task Force).</p>

<p>HTTP je postaveno na architektuøe klient-server. Komunikace je bezstavová s následujícím základním schématem: klient otevøe na server spojení, po¹le svoji ¾ádost a po doruèení odpovìdi je spojení uzavøeno.
Protokol má textovou podobu a je mu vyhrazen tcp port 80.</p>

Pøíklad jednoduché komunikace:
<pre>
$ telnet localhost 80
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
<b>GET / HTTP/1.0</b>
<b>Host: localhost</b>

HTTP/1.1 200 OK
Date: Sun, 01 Nov 2009 14:06:54 GMT
Server: Apache
Last-Modified: Sun, 01 Nov 2009 14:05:04 GMT
Accept-Ranges: bytes
Content-Length: 279
Connection: close
Content-Type: text/html

&lt;html&gt;
&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome&lt;/h1&gt;
&lt;p&gt;It's working!&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
Connection closed by foreign host.
</pre>

<h3 id="http:verze">Verze protokolu</h3>
<ul>
<li>0.9 - pùvodní dnes zastaralá verze, pouze metoda GET</li>
<li>1.0 - RFC 1945 (1996)</li><ul>
	<li>hlavièky pro po¾adavky i odpovìdi</li>
	<li>nové metody HEAD a POST</li>
	<li>stavové kódy</li>
</ul>
<li>1.1 - RFC 2086 (1999)</li><ul>
	<li>keep-alive - mo¾nost znovu pou¾ít otevøené spojení k vyslání dal¹ího po¾adavku (v¹echny spojení perzistentní, ale timeout bývá nastaven na nìkolik sekund)</li>
	<li>pipelining - odeslání nìkolika po¾adavkù zároveò (vìt¹ina prohlí¾eèù zatím nepou¾ívá ve výchozím nastavení)</li>
	<!-- <li>upgrade spojení na ¹ifrované TLS </li> -->
	<li>dal¹í metody (PUT,DELETE,TRACE,CONNECT,OPTIONS)</li>
</ul>
</ul>

<h3 id="http:metody">Metody</h3>
<p>Urèují typ po¾adavku klienta. Mezi základní patøí:</p>
<!-- GET,HEAD,OPTIONS,TRACE vs POST,PUT,DELETE -->
<table>
<tr><td><code>GET</code></td><td>po¾adavek na HTML stránku nebo jiný soubor</td></tr>
<tr><td><code>HEAD</code></td><td>po¾adavek na hlavièku HTML stránky</td></tr>
<tr><td><code>POST</code></td><td>pøedávání dat na server</td></tr>
<tr><td><code>PUT</code></td><td>nahraje soubor na server</td></tr>
<tr><td><code>DELETE</code></td><td>ma¾e soubor na serveru</td></tr>
<tr><td><code>OPTIONS</code></td><td>zji¹»ování mo¾ností spojení</td></tr>
<tr><td><code>TRACE</code></td><td>sledování dotazu zasílaný na server</td></tr>
<tr><td><code>CONNECT</code></td><td>nastavení spojení</td></tr>
</table>

<h3 id="http:header">Hlavièky</h3>
<p>
Vychází ze standardu MIME. Ka¾dá hlavièka je uvedena na samostatném øádku ve tvaru:
<pre>jméno-hlavièky: hodnota</pre>
Pokud hlavièka zaèíná bílým znakem, jde o pokraèování z pøedchozího øádku.
</p>

<h4>Zasílané klientem</h4>
<p>Doplòují po¾adavek zaslaný serveru. Nìkteré z nich:</p>
<table>
<tr><td><code>Host</code></td><td>uvádí plné doménové jméno serveru</td></tr>
<tr><td><code>Accept</code></td><td>seznam MIME typù, kterým klient rozumí</td></tr>
<tr><td><code>Accept-Charset</code></td><td>preferovaný znakové sady</td></tr>
<tr><td><code>Accept-Encoding</code></td><td>preferované kódování</td></tr>
<tr><td><code>Accept-Language</code></td><td>preferované jazyky</td></tr>
<tr><td><code>User-Agent</code></td><td>identifikace klienta</td></tr>
</table>

<h4>Zasílané serverem</h4>
<p>Popisují zasílaná data, nìkteré zajímavé:</p>
<table>
<tr><td><code>Content-Type</code></td><td>MIME typ zasílaných dat, napø. image/png</td></tr>
<tr><td><code>Content-Encoding</code></td><td>kódování zasílaných dat</td></tr>
<tr><td><code>Content-Length</code></td><td>délka dat</td></tr>
<tr><td><code>Expires</code></td><td>platnost dat</td></tr>
<tr><td><code>Server</code></td><td>identifikace serveru</td></tr>
</table>

<h3 id="http:kody">Stavové kódy</h3>
<p>
Stavový kód reprezentuje stav zpracování dotazu serverem.
Je uveden na prvním øádku odpovìdi serveru (pøed hlavièkou).
Kódy jsou rozdìleny do 5 skupin:
</p>
<ul>
<li><b>1xx</b> informaèní</li>
<li><b>2xx</b> úspìch <br/> pø. 200 OK</li>
<li><b>3xx</b> pøesmìrování <br/> pø. 301 Moved Permanently</li> 
<li><b>4xx</b> chyba na stranì klienta <br/> pø. 404 Not Found</li> 
<li><b>5xx</b> chyba na stranì serveru <br/> pø. 503 Service Unavailable</li> 
</ul>

<h2 id="apache">Apache</h2>
<p>
Server Apache dlouhodobì patøí mezi nejroz¹íøenìj¹í http servery. Vznikl z NCSA HTTPd serveru a v souèasnosti se o jeho vývoj stará Apache Software Foundation.
</p>

<p>Instalaci lze provést pomocí balíèkovacího systému, na Debianu jde o balíèek apache2.</p>

<h3 id="apache:conf">Základní konfigurace</h3>
<p>
Konfigurace je kvùli pøehlednosti rozdìlena do nìkolika konfiguraèních souborù. Ve výchozím nastavení je hlavním konfiguraèní souborem httpd.conf.
Ka¾dá distribuce øe¹í rozmístìní a pojmenování konfiguraèních souborù jinak, napø.
Debian má konfiguraèní soubory v adresáøi /etc/apache2 s hlavním konfiguraèním souborem apache2.conf.
</p>

<h4>Nìkteré konfiguraèní direktivy</h4>
<table>
<tr><td><code>ServerName</code></td><td>nastavuje jméno serveru</td></tr>
<tr><td><code>DocumentRoot</code></td><td>koøenový adresáø serveru</td></tr>
<tr><td><code>KeepAlive</code></td><td>povoluje vý¹e zmínìných perzistentních spojení</td></tr>
<tr><td><code>Listen</code></td><td>urèuje kde (adresa a port) bude server èekat po¾adavky</td></tr>
<tr><td><code>Include</code></td><td>vlo¾ení konfigurace z jiného souboru</td></tr>
</table>

<h3 id="apache:mod">Moduly</h3>
<p>
Apache je navr¾en modulárnì a existuje tak pro nìj spousta roz¹iøujících modulù.Ty mohou být buï pøímo zakompilovány v serveru nebo zvlá¹» ve formì sdílených knihoven. Konkrétní externí moduly se zapínají pomocí direktivy LoadModule.
Pou¾ití, napø.:
</p>
<ul>
<li>bìh skriptovacích jazykù v rámci Apache: mod_perl, mod_php, mod_python, ...</li>
<li>autentizace: mod_auth*</li>
<li>podpora pro SSL: mod_ssl</li>
<li>pøesmìrování: mod_rewrite, mod_alias</li>
</ul>

<h3 id="apache:virt">Virtuální servery</h3>
<p>
Server Apache doká¾e provozovat více nezávislých serverù v rámci jednoho stroje, èeho¾ se vyu¾ívá napø. pøi webhostingu. Konfigurace virtuálního serveru je nezávislá na ostatních - ka¾dý má svùj adresáø s daty, log a pod.
Aby bylo mo¾né od sebe virtuální stroje rozeznat, má ka¾dý pøiøazenu buï pøímo ip adresu (tj. fyzické nebo virtuální sí»ové rozhraní) nebo doménové jméno.  
</p>

<p>Pøíklad konfigurace virtuálních serverù dle jména (name-based): na stroji s jednou ip adresou provozujeme servery pro www.domain.tld a www.otherdomain.tld.
<pre>
NameVirtualHost *:80

&lt;VirtualHost *:80&gt;
  ServerName www.domain.tld
  ServerAlias domain.tld *.domain.tld
  DocumentRoot /www/domain
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
  ServerName www.otherdomain.tld
  DocumentRoot /www/otherdomain
&lt;/VirtualHost&gt;
</pre>
</p>

<p>Pøíklad konfigurace virtuálních serverù dle ip adresy (ip-based):
na stroji, který má nìkolik sí»ových rozhraní, provozujeme server pro ka¾dé rozhraní zvlá¹».
<pre>
&lt;VirtualHost 172.20.30.40&gt;
  DocumentRoot /www/example1
  ServerName www.example.com
&lt;/VirtualHost&gt;
 
&lt;VirtualHost 172.20.30.50&gt;
  DocumentRoot /www/example2
  ServerName www.example.org
&lt;/VirtualHost&gt;
</pre>
</p>

<p>Obì mo¾nosti jdou kombinovat, napø. v pøípadì, kdy má stejný server bì¾et na více rùzných rozhraních.</p>

<h3 id="apache:ssl">SSL</h3>
<p>
SSL zaji¹»uje zabezpeèený pøenos dat zalo¾ený na kryptografii s veøejným klíèem. Certifikát serveru mù¾e pro zvý¹ení dùvìryhodnosti podepsán certifikaèní autoritou. 
Pro pou¾ití SSL je tøeba naèíst modul mod_ssl, který je rozhraním pro knihovnu OpenSSL.
</p>
 
<p>
U virtuálních serverù zalo¾ených na jménì lze zprovoznit podporu pro SSL jen u jednoho z nich, jinak by do¹lo ke konfliktùm - SSL certifikáty jsou vystavovány na doménové jméno.
</p>

<p>Ukázka konfigurace SSL u virtuálního serveru:
<pre>
&lt;VirtualHost _default_:443&gt;
  SSLEngine on
  SSLCertificateFile    /etc/pki/tls/certs/localhost.cert
  SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
&lt;/VirtualHost&gt;
</pre>
</p>


<h3 id="apache:cgi">CGI</h3>
<p>
Jde o techniku, která umo¾òuje spou¹tìní skriptù pro generování http odpovìdí.
Øe¹í podobný problém jako mod_php nebo mod_perl, ale není omezeno na konkrétní jazyk.
Pro spou¹tìní cgi skriptù je nutné naèíst modul mod_cgi.
</p>

<p>
CGI skripty je mo¾né umístit v jednom adresáøi pomocí direktivy ScriptAlias, která zaji¹»uje pøesmìrování i povolení ke spou¹tìní skriptù:
<pre>ScriptAlias /cgi-bin/ "/usr/local/apache2/cgi-bin/"</pre>
</p>

<p>
Dále je mo¾né povolit spou¹tìní skriptù mimo adresáø cgi-bin dle pøípony:
<pre>
&lt;Directory /home/*/public_html&gt;
  Options +ExecCGI
  AddHandler cgi-script .cgi
  DirectoryIndex index.html index.cgi
&lt;/Directory&gt;
</pre>
</p>



<h2 id="impl">Alternativní implementace</h2>
<ul>
<li>lighttpd - zamìøen na men¹í pamì»ovou i procesorovou nároènost</li>
<li>Java Servlet container: Tomcat, Jetty, Glassfish</li>
</ul>


<h2 id="literatura">Literatura</h2>
<ul>
<li><a href="http://www.fi.muni.cz/~kas/p090/referaty/">Archív referátù</a></li>
<li><a href="http://www.fi.muni.cz/~kas/p005/p005-6.ps">Slu¾by poèítaèových sítí (HTTP, IPv6)</a></li>
<li><a href="http://en.wikipedia.org/wiki/HTTP_persistent_connection">HTTP persistent connection</a></li>
<li><a href="http://httpd.apache.org/docs/2.2/">Manuál serveru Apache 2.2</a></li>
</ul>
</body>
</html>
